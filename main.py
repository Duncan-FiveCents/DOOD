# main.py

'''
title: DOOD
author: Duncan Nickel
date-created: 22/11/2022
'''

import pygame

from window import Window
from raycasting import RayCasting
from player import Player
from userInterface import HUD
import weapon

game_map = [
    '1111111111111111111111111111111111111111',
    '1111111111111111111111111111111111111111',
    '1111111111111111111111111111111111111111',
    '1111111111111111111111111111111111111111',
    '1111111111111111111111111111111111111111',
    '1111111111111111111111111111111111111111',
    '1111111111111111111000000111111111111111',
    '1111111111111111111000000111111111111111',
    '1111111110000001111001100111111111111111',
    '1111111110000001111000000111111111111111',
    '1111111110000000000000000000011111111111',
    '1111111110000000000001100000011111111111',
    '1111111110000000000000000000011111111111',
    '1111111110000011111000000100011111111111',
    '1111111111110011111001100100011111111111',
    '1110000001110011111000000100011111000111',
    '1110000001110011111000000100000000000111',
    '1110000001110011111111111100000000000111',
    '1000000001110011111110011100000000000111',
    '1000000001110011111110011100011111000111',
    '1000000000000011111110011100011111000111',
    '1000000000000010000000011100011110000011',
    '1000000000000010000000011100011100000001',
    '1000000001110010000000011100011100000001',
    '1000000001110011111111111100011100000001',
    '1110000001110011111111111100011111111111',
    '1110000001110011111111111100010001111111',
    '1110000001110011111111111100010001111111',
    '1111111111110011111110000000000001111111',
    '1111110000000000111110000000000000000111',
    '1111110000000000111110000000000000000111',
    '1111110000000000111110000000000000000001',
    '1111110000000000111110000000000000000001',
    '1111110000000000111110000000000000000001',
    '1111110000000000111111100000000000000111',
    '1111111111111111111111100000000000000111',
    '1111111111111111111111100000011110000111',
    '1111111111111111111111100000011110000111',
    '1111111111111111111111111111111111111111',
    '1111111111111111111111111111111111111111'
]

WINDOW = Window()

SHOTGUN = weapon.Shotgun()
UI = HUD(WINDOW,SHOTGUN)
RAYS = RayCasting(WINDOW.screen,4,len(game_map),UI.minimap)
minimapActive = False

PLAYER = Player([RAYS.tileSize * 2,RAYS.tileSize * 22])

if __name__ == "__main__":
    pygame.init()

    while True:
        PRESSED = pygame.key.get_pressed()
        MOUSE = pygame.mouse.get_pressed()
        for event in pygame.event.get():
            if event.type == pygame.QUIT or PRESSED[pygame.K_ESCAPE]: # ESC will be used to pause later
                pygame.quit()
                exit()
        
        if (PRESSED[pygame.K_SPACE] or MOUSE[0]) and PLAYER.cooldown == 0:
            PLAYER.cooldown = 15
        
        if PRESSED[pygame.K_m]:
            if minimapActive == False: minimapActive = True
            else: minimapActive = False

        PLAYER.turnPlayer(PRESSED,(WINDOW.screen.get_width()/2,WINDOW.screen.get_height()/2))
        PLAYER.movePlayer(PRESSED)

        WINDOW.clearScreen()

        # Raycasting
        RAYS.draw3D()
        RAYS.castRays(game_map,PLAYER.rect.center,PLAYER.angle)

        # Weapon Animation
        if PLAYER.cooldown != 0:
            SHOTGUN.playAnim(PLAYER.cooldown//3)
            PLAYER.cooldown -= 1
        UI.weaponHud(PLAYER.activeWeapon)

        # User Interface
        UI.mainHud(PLAYER.health,PLAYER.sheild)

        RAYS.drawMap(game_map,PLAYER.rect,PLAYER.angle)

        if minimapActive:
            MINIMAP = pygame.transform.scale(UI.minimap,(300,300))
            WINDOW.screen.blit(MINIMAP,(WINDOW.screen.get_width()/2 - 150,0))

        WINDOW.updateFrame()